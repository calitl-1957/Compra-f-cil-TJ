<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Compra Fácil TJ</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <h1>Catálogo Compra Fácil TJ</h1>

  <!-- Input para cargar CSV o Excel -->
  <input type="file" id="fileInput" accept=".csv,.xlsx" />

  <table border="1" id="catalogo">
    <thead>
      <tr>
        <th>Código</th>
        <th>Descripción</th>
        <th>Precio</th>
        <th>Imagen</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    document.getElementById('fileInput').addEventListener('change', handleFile, false);

    function handleFile(e) {
      const file = e.target.files[0];
      const reader = new FileReader();

      if (file.name.endsWith('.csv')) {
        reader.onload = function(event) {
          const text = event.target.result;
          const rows = text.split('\n').map(row => row.split(','));
          renderTable(rows);
        };
        reader.readAsText(file);
      } else if (file.name.endsWith('.xlsx')) {
        reader.onload = function(event) {
          const data = new Uint8Array(event.target.result);
          const workbook = XLSX.read(data, { type: 'array' });
          const sheetName = workbook.SheetNames[0];
          const sheet = workbook.Sheets[sheetName];
          const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });
          renderTable(rows);
        };
        reader.readAsArrayBuffer(file);
      }
    }

    function renderTable(rows) {
      const tbody = document.querySelector('#catalogo tbody');
      tbody.innerHTML = '';
      rows.slice(1).forEach(row => {
        if (row.length >= 3) {
          const tr = document.createElement('tr');
          const codigo = row[0];
          const descripcion = row[1];
          const precio = row[2];
          tr.innerHTML = `
            <td>${codigo}</td>
            <td>${descripcion}</td>
            <td>${precio}</td>
            <td><img src="img/${codigo}.png" alt="${descripcion}" width="80"></td>
          `;
          tbody.appendChild(tr);
        }
      });
    }
  </script>
</body>
</html>
